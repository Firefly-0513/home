<!DOCTYPE html>
<html lang="cn-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>booking system</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      .inline-container {
        display: flex;
        align-items: center;
        position: sticky;
        top: 0;
        width: 100%;
        height: 15vh;
        background-color: #fb85b4;
        padding: 0 0% 0 2%;
        box-sizing: border-box;
        z-index: 100;
      }
      .inline-container img {
        margin-right: 3%;
        height: auto;
        max-height: 12vh;
        max-width: 12vw;
      }
      .inline-container p {
        font-size: 2.5vw;
        color: #ffffff;
        margin: 90px;
      }

      .layout-container {
        display: flex;
        min-height: calc(100% - 15vh);
      }

      .left {
        width: 12%;
        background-color: #c2353a;
        position: sticky;
        top: 15vh;
        padding: 2%;
        box-sizing: border-box;
      }
      .left_text {
        list-style-type: none;
        padding: 0;
        margin: 2%;
        line-height: 3;
        font-size: 1.2vw;
        font-weight: bold;
        text-decoration: none;
        color: #000000;
      }

      .left_text a {
        text-decoration: none;
        color: #000000;
      }

      .main {
        flex: 1;
        padding: 2vh 2vw;
        font-size: 2.5vw;
        box-sizing: border-box;
        text-align: center;
      }


      .form-input {
        padding: 0 0 15px 10vw;
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        font-size: 1.5vw; 
        margin-right: 20px;
      }
      
      .form-input label {
        padding: 0 0 1vh 0;
        margin-right: 30px; 
        white-space: nowrap;
        font-weight: bold; 
      }

      .form-input input,
      .form-input select {
         flex: 1; 
         width: 80%; 
         height: 36px;
         max-width: 400px; 
         min-width: 70px;  
      }

    </style>
  </head>

  <body>
    <!-- top -->
    <div class="inline-container">
      <a href="index.html">
        <img src="image/school_logo(nb).png" alt="LKPFC Logo" />
      </a>
      <p><b>LKPFC Classroom Booking System </b></p>
    </div>


    <!-- left -->
    <div class="layout-container">
      <div class="left">
        <ul class="left_text">
          <li><a href="index.html">Home</a></li>
          <li><a href="booking.html">Booking</a></li>
          <li><a href="test.html">Test </a></li>
        </ul>
      </div>

      <!-- main -->
      <div class="main">
        <p>Welcome for booking</p>
        <form id="bookingForm">

          <div class="form-input">
           <label >Teacher ID :</label>
           <input type="text" id="tid"  required >
          </div>

          <div class="form-input">
            <label >Classroom :</label>
            <select id="cid" required>
              <option value="101">1A</option>
              <option value="102">1B</option>
              <option value="103">1C</option>
              <option value="104">1D</option>
              <option value="105">1E</option>
              <option value="201">2A</option>
              <option value="202">2B</option>
              <option value="203">2C</option>
              <option value="204">2D</option>
              <option value="205">2E</option>
              <option value="301">3A</option>
              <option value="302">3B</option>
              <option value="303">3C</option>
              <option value="304">3D</option>
              <option value="305">3E</option>
              <option value="206">AAR</option>
              <option value="207">MUSIC ROOM</option>              
              <option value="106">SAC</option>
              <option value="107">HALL</option>              
              <option value="306">BIO LAB</option>
              <option value="307">PHY LAB</option>              
            </select>
          </div>

          <div class="form-input">
            <label >Booking Date :</label>
            <input type="date" id="bdate"  required >
          </div>

          <div class="form-input">
           <label >Starting Time :</label>
           <input type="time" id="stime" required>
          </div>

          <div class="form-input">
           <label >Ending Time :</label>
           <input type="time" id="etime" required>
          </div>          

          <div class="form-input">
           <label >Reason :</label>
           <input type="text" id="reason"  required >
          </div>

          <div class="form-input">
           <label>Number of People Using :</label>
           <input type="text" id="people"  required >
          </div>

          <div class="form-input">
           <label for="special">Special Requirements :</label>
           <input type="text" id="special"  value="NA" required >
           <p style="font-size: 0.8vw;">(if no, please type "NA")</p>
          </div>          

          <div class="form-input">
           <button type="submit" >Confirm Booking</button>
          </div> 
        </form>

        <p id="book"></p>

        <script>
          document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
              tid: document.getElementById('tid').value.trim(),
              cid: document.getElementById('cid').value.trim(),
              bdate: document.getElementById('bdate').value,
              stime: document.getElementById('stime').value,
              etime: document.getElementById('etime').value,
              reason: document.getElementById('reason').value.trim(),
              people: parseInt(document.getElementById('people').value),
              special: document.getElementById('special').value.trim()
            };
 

            try {
              const res = await fetch('/book', {  // 這裡是您改的路由，確認正確
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              }); 

              const text = await res.text();  // 先读文本，避免 json() 失败
              console.log('console:', text);  // 在浏览器 Console 查看完整响应

              let result;
              try {
                result = JSON.parse(text);  // 尝试解析 JSON
              } catch (parseErr) {
                document.getElementById('book').style.color = 'red';
                document.getElementById('book').textContent = 'error: ' + text;
                return;
              }

              if (res.ok) {
                alert(result.message || 'Booking success!');
                document.getElementById('bookingForm').reset();
              } else {
                alert(result.error || result.details || 'Booking failed!');
              }
            } catch (err) {
              alert('Cant connect to server. Please try again later.');
            }  
          });
        </script>

        </div>
        </div> 
      </div>
</body>
</html>