<!DOCTYPE html>
<html lang="cn-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>booking system</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      .inline-container {
        display: flex;
        align-items: center;
        position: sticky;
        top: 0;
        width: 100%;
        height: 15vh;
        background-color: #fb85b4;
        padding: 0 0% 0 2%;
        box-sizing: border-box;
        z-index: 100;
      }
      .inline-container img {
        margin-right: 3%;
        height: auto;
        max-height: 12vh;
        max-width: 12vw;
      }
      .inline-container p {
        font-size: 2.5vw;
        color: #ffffff;
        margin: 90px;
      }

      .main {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 2vh 2vw;
        font-size: 2.5vw;
        box-sizing: border-box;
        text-align: center;
        font-weight: bold;
        flex: 1; /* 確保 main 填滿剩餘空間 */
        background-color: rgb(248, 242, 247);
        max-height: 100vh;
      }

      .main .top {
        width: 100%;
        text-align: center;
        margin-bottom: 20px;
      }

      .main .left {
        width: 100%;
        border: 4px solid #c2353a; /* 黑色包邊 */
        box-sizing: border-box;
        padding: 7vh 0 15px 2vw;
        border-radius: 50px;
        margin-top: 3vw;
        margin-right: 25vw;
        margin-left: 25vw;
        margin-bottom: 30vh;
        background-color: rgb(255, 255, 255);
      }

      .form-input {
        padding: 15px 0;
        display: flex;
        align-items: center;
        justify-content: center; /* 置中對齊 */
        margin-bottom: 15px;
        font-size: 1.5vw;
      }

      .form-input input {
        flex: 1;
        width: 90%;
        height: 60px;
        max-width: 500px;
        min-width: 70px;
        border-radius: 12px;
      }

      .form-input button {
        font-size: 1vw;
        padding: 10px 20px;
        min-width: 200px;
        background-color: rgb(28, 190, 28);
        color: white;
        border-radius: 12px;
      }
    </style>
  </head>

  <body>
    <!-- top -->
    <div class="inline-container">
      <a href="index.html">
        <img src="image/school_logo(nb).png" alt="LKPFC Logo" />
      </a>
      <p><b>LKPFC Classroom Booking System V1.0.57</b></p>
    </div>


      <!-- main -->
      <div class="main">
        <div class="top">
          <p>Login</p>
          <div
            style="
              width: 100%;
              height: 1vh;
              background-color: #fb85b4;
              margin-top: 10px;
              border-radius: 20px;
            "
          ></div>
        </div>

        <div class="left">
          <form id="loginForm">
            <div class="form-input">
              <input type="text" id="username" placeholder="Username" required />
            </div>
            <div class="form-input">
              <input type="password" id="password" placeholder="Password" required />
            </div>
            <div class="form-input">
              <button type="submit">Login</button>
            </div>
          </form>
          <p class="error" id="errorMsg"></p>

          <script>
            document.getElementById("loginForm").addEventListener("submit", async (e) => {
              e.preventDefault();
              const username = document.getElementById("username").value.trim();
              const password = document.getElementById("password").value;

              try {
                const res = await fetch("/login", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ username, password })
                });

                const data = await res.json();

                if (res.ok && data.success) {
                  localStorage.setItem('userTid', data.tid);       // 關鍵！儲存 TID
                // 登錄成功，根據角色跳轉
                  if (data.role === "A") {
                    window.location.href = "/A_home.html";
                  } else if (data.role === "T") {
                    window.location.href = "/T_home.html";
                  }
                } else {
                  document.getElementById("errorMsg").textContent = 
                    data.error || "Invalid username or password.";
                }
              } catch (err) {
                document.getElementById("errorMsg").textContent = 
                  "Unable to connect to server, please check your network";
              } 
            });
          </script>          



        </div>
      </div>
    </div>
  </body>
</html>